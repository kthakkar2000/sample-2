<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Page ‚Äî Product & Voice Bot</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#0b71ff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:900px;margin:36px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    .logo{width:64px;height:64px;border-radius:12px;object-fit:contain;background:#fff;padding:6px}
    .title{font-size:20px;font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:12px;padding:20px;margin-top:18px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    .grid{display:flex;gap:20px}
    .left{flex:1}
    .right{width:320px}
    .product-img{width:100%;height:360px;object-fit:contain;background:#fafafa;border-radius:8px}
    .thumbs{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .thumbs img{width:72px;height:56px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent}
    .thumbs img.active{border-color:var(--accent);transform:translateY(-2px)}
    ul{padding-left:18px}
    .controls{display:flex;gap:8px;margin-top:12px}
    button{background:var(--accent);color:#fff;padding:10px 12px;border:none;border-radius:8px;cursor:pointer}
    button.secondary{background:#eef2ff;color:var(--accent);border:1px solid rgba(11,113,255,0.12)}
    .log{margin-top:12px;background:#f8fafc;padding:12px;border-radius:8px;color:var(--muted);min-height:60px}
    .hint{font-size:13px;color:var(--muted);margin-top:6px}
    footer{margin-top:20px;color:var(--muted);font-size:13px}
    .qr{display:inline-block;padding:8px;background:#fff;border-radius:8px}
    @media (max-width:880px){ .grid{flex-direction:column} .right{width:auto} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img id="logo" class="logo" src="assets/ktpl-new-logo.png" alt="logo"/>
      <div>
        <div id="productTitle" class="title">Product Title</div>
        <div id="productTag" class="subtitle">Short tagline or model number</div>
      </div>
    </header>

    <div class="card grid">
      <div class="left">
        <img id="productImg" class="product-img" src="assets/wm1.avif" alt="product"/>

        <!-- THUMBNAILS: will be filled by JS using PRODUCT_DATA.images -->
        <div id="thumbs" class="thumbs" aria-hidden="false"></div>

        <h3 style="margin-top:14px">Description</h3>
        <p id="productDesc">Product description goes here. This text explains main benefits and short summary. Use this for QR spoken description.</p>

        <h4 style="margin-top:10px">Features</h4>
        <ul id="featuresList">
          <li>Feature 1</li>
          <li>Feature 2</li>
        </ul>

        <div class="hint">Tip: Duplicate this file for every product and change the PRODUCT_DATA below, or host small JSON files under <code>products/</code> and open with <code>?id=product-id</code>.</div>
      </div>

      <div class="right">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Voice Assistant</div>
            <div class="subtitle">Ask about this product ‚Äî speak or type</div>
          </div>
          <div class="qr">QR: <small id="qrHint">Scan to open</small></div>
        </div>

        <div style="margin-top:12px">
          <textarea id="userText" placeholder="Type your question..." style="width:100%;height:88px;padding:8px;border-radius:8px;border:1px solid #eef2ff"></textarea>

          <!-- Language toggle -->
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
            <label style="font-weight:600">Language:</label>
            <select id="langSelect" style="padding:6px 10px; border-radius:8px;">
              <option value="en">English</option>
              <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
            </select>
          </div>

          <div class="controls" style="margin-top:10px">
            <button id="startBtn">üé§ Speak</button>
            <button id="askBtn" class="secondary">Ask</button>
            <button id="readDescBtn" class="secondary">üîä Read Description</button>
          </div>
          <div class="log" id="botLog">Assistant ready. Try: "How much water does it use?"</div>
        </div>

        <div style="margin-top:14px">
          <div style="font-weight:700">Specs</div>
          <table style="width:100%;margin-top:6px">
            <tr><td class="subtitle">Capacity</td><td id="specCapacity">7 kg</td></tr>
            <tr><td class="subtitle">Spin Speed</td><td id="specSpin">1200 RPM</td></tr>
            <tr><td class="subtitle">Energy</td><td id="specEnergy">5 Star</td></tr>
            <tr><td class="subtitle">Warranty</td><td id="specWarranty">2 yrs</td></tr>
          </table>
        </div>
      </div>
    </div>

    <footer>
      To generate a QR for this product page: create a link to this page (for example <code>https://yourshop.github.io/product-page.html?id=washing-machine-7kg</code>) and make a QR from that URL. Host the file and any <code>products/*.json</code> on GitHub Pages or any static host.
    </footer>
  </div>

  <script>
    /* ======================================================
       Gallery + English/ Gujarati voice bot (client-only)
       - Place images in assets/:
         assets/wm1.avif ... assets/wm5.avif
         assets/ktpl-new-logo.png
       ======================================================== */

    // ------------------ CANNED RESPONSES (EN + GU) ------------------
    const canned = [
      { q: /price|cost|‚Çπ|rupee/i, a: 'The price of this model is Sixty five thousand rupees only.', gu: '‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤‡™®‡´Ä ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‡™∞‡´Ç. 65,000 ‡™õ‡´á. ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç EMI ‡™Ö‡™®‡´á exchange ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™õ‡´á.' },
      { q: /stock|available/i, a: 'This model has only 4 pieces left in stock. We also offer EMI and exchange options in-store.', gu: '‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤‡™®‡™æ ‡™∏‡´ç‡™ü‡´ã‡™ï‡™Æ‡™æ‡™Ç ‡™´‡™ï‡´ç‡™§ 4 ‡™™‡´Ä‡™∏ ‡™¨‡™æ‡™ï‡´Ä ‡™õ‡´á. ‡™Ö‡™Æ‡´á ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç EMI ‡™Ö‡™®‡´á ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™µ‡™ø‡™ï‡™≤‡´ç‡™™‡´ã ‡™™‡™£ ‡™™‡´ç‡™∞‡™¶‡™æ‡™® ‡™ï‡™∞‡´Ä‡™è ‡™õ‡´Ä‡™è.' },
      { q: /warrant(?:y|ies)|guarantee/i, a: 'This product comes with a two year manufacturer warranty covering defects and parts.', gu: '‡™Ü ‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™æ‡™•‡´á 2 ‡™µ‡™∞‡´ç‡™∑‡™®‡´Ä ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™Æ‡™≥‡´á ‡™õ‡´á ‡™ú‡´á ‡™ñ‡™æ‡™Æ‡´Ä ‡™Ö‡™®‡´á ‡™≠‡™æ‡™ó‡´ã‡™®‡´á ‡™¢‡™ï‡´á ‡™õ‡´á.' },
      { q: /capacity|kg|weight/i, a: 'The machine has a 12 kilogram capacity ‚Äî suitable for small families.', gu: '‡™Ü ‡™Æ‡™∂‡´Ä‡™®‡™®‡´Ä ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ 12 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ ‡™õ‡´á ‚Äî ‡™®‡™æ‡™®‡™æ‡™Ç ‡™™‡™∞‡™ø‡™µ‡™æ‡™∞‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™™‡´Ç‡™∞‡™§‡´Ä.' },
      { q: /rpm|spin|speed/i, a: 'Maximum spin speed is 1200 RPM which helps remove more water and reduce drying time.', gu: '‡™Æ‡™π‡™§‡´ç‡™§‡™Æ ‡™∏‡´ç‡™™‡™ø‡™® ‡™∏‡´ç‡™™‡´Ä‡™° 1200 RPM ‡™õ‡´á ‡™ú‡´á ‡™µ‡™ß‡´Å ‡™™‡™æ‡™£‡´Ä ‡™¶‡´Ç‡™∞ ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ö‡™®‡´á ‡™∏‡´Ç‡™ï‡™µ‡™æ‡™®‡´á ‡™ü‡´Ç‡™Ç‡™ï‡™æ‡™µ‡™Æ‡™æ‡™Ç ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´á ‡™õ‡´á.' },
      { q: /energy|star/i, a: 'This is a 5-star energy rated appliance ‚Äî very efficient on power consumption.', gu: '‡™Ü ‡™è‡™ï 5-‡™∏‡´ç‡™ü‡™æ‡™∞ ‡™è‡™®‡™∞‡´ç‡™ú‡´Ä ‡™∞‡´á‡™ü‡´á‡™° ‡™â‡™™‡™ï‡™∞‡™£ ‡™õ‡´á ‚Äî ‡™™‡™æ‡™µ‡™∞ ‡™ñ‡™∞‡´ç‡™ö‡™Æ‡™æ‡™Ç ‡™ñ‡´Ç‡™¨ ‡™Ö‡™∏‡™∞‡™ï‡™æ‡™∞‡™ï.' },
      { q: /how to clean|clean|care/i, a: 'Use a mild detergent, run monthly drum clean cycle and wipe the door seal to avoid residue.', gu: '‡™π‡™≥‡™µ‡´ã ‡™°‡™ø‡™ü‡™∞‡´ç‡™ú‡´á‡™®‡´ç‡™ü ‡™µ‡™æ‡™™‡™∞‡´ã, ‡™Æ‡™æ‡™∏‡™ø‡™ï ‡™°‡´ç‡™∞‡™Æ ‡™ï‡´ç‡™≤‡´Ä‡™® ‡™∏‡™æ‡™à‡™ï‡™≤ ‡™ö‡™≤‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™°‡´ã‡™∞ ‡™∏‡´Ä‡™≤ ‡™∏‡™æ‡™´ ‡™ï‡™∞‡´ã.' },
      { q: /brand|company|model/i, a: 'This model is from ABC Electronics, known for durability and advanced features.', gu: '‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤ ABC ‡™á‡™≤‡´á‡™ï‡´ç‡™ü‡´ç‡™∞‡´ã‡™®‡™ø‡™ï‡´ç‡™∏‡™®‡´Å‡™Ç ‡™õ‡´á, ‡™ú‡´á ‡™ü‡™ï‡™æ‡™â‡™™‡™£‡´Å‡™Ç ‡™Ö‡™®‡´á ‡™Ö‡™¶‡´ç‡™Ø‡™§‡™® ‡™∏‡´Å‡™µ‡™ø‡™ß‡™æ‡™ì ‡™Æ‡™æ‡™ü‡´á ‡™ú‡™æ‡™£‡´Ä‡™§‡´Å‡™Ç ‡™õ‡´á.' },
      { q: /size|dimension|height|width|depth/i, a: 'The machine measures 85 cm in height, 60 cm in width and 55 cm in depth.', gu: '‡™Ü ‡™Æ‡™∂‡´Ä‡™®‡™®‡´Ä ‡™ä‡™Ç‡™ö‡™æ‡™à 85 ‡™∏‡´á‡™Æ‡´Ä, ‡™™‡™π‡´ã‡™≥‡™æ‡™à 60 ‡™∏‡´á‡™Æ‡´Ä ‡™Ö‡™®‡´á ‡™ä‡™Ç‡™°‡™æ‡™à 55 ‡™∏‡´á‡™Æ‡´Ä ‡™õ‡´á.' },
      { q: /water|litre|consumption/i, a: 'This model consumes approximately 60 liters of water per full wash cycle.', gu: '‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤ ‡™¶‡™∞‡´á‡™ï ‡™™‡´Ç‡™∞‡´ç‡™£ ‡™µ‡´ã‡™∂ ‡™∏‡™æ‡™Ø‡™ï‡™≤‡™Æ‡™æ‡™Ç ‡™Ö‡™Ç‡™¶‡™æ‡™ú‡´á 60 ‡™≤‡™ø‡™ü‡™∞ ‡™™‡™æ‡™£‡´Ä ‡™µ‡™æ‡™™‡™∞‡´á ‡™õ‡´á.' },
      { q: /noise|sound|db|decibel/i, a: 'The machine operates at 52 dB during wash and 72 dB during spin ‚Äî relatively quiet.', gu: '‡™Ü ‡™Æ‡™∂‡´Ä‡™® ‡™ß‡´ã‡™µ‡™æ‡™®‡´Ä ‡™™‡´ç‡™∞‡™ï‡´ç‡™∞‡™ø‡™Ø‡™æ‡™Æ‡™æ‡™Ç 52 dB ‡™Ö‡™®‡´á ‡™∏‡´ç‡™™‡™ø‡™® ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® 72 dB ‡™™‡™∞ ‡™ï‡™æ‡™∞‡´ç‡™Ø ‡™ï‡™∞‡´á ‡™õ‡´á ‚Äî ‡™§‡´Å‡™≤‡™®‡™æ‡™§‡´ç‡™Æ‡™ï ‡™∞‡´Ä‡™§‡´á ‡™∂‡™æ‡™Ç‡™§ ‡™õ‡´á.' },
      { q: /delivery|install|setup/i, a: 'Free delivery and installation are provided within city limits.', gu: '‡™∂‡™π‡´á‡™∞‡™®‡´Ä ‡™Ö‡™Ç‡™¶‡™∞ ‡™Æ‡™´‡™§ ‡™°‡™ø‡™≤‡™ø‡™µ‡™∞‡´Ä ‡™Ö‡™®‡´á ‡™á‡™®‡´ç‡™∏‡´ç‡™ü‡´ã‡™≤‡´á‡™∂‡™® ‡™Ü‡™™‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´á ‡™õ‡´á.' },
      { q: /offer|discount|deal|sale/i, a: 'We currently have a festive discount available. Please check in-store for final price.', gu: '‡™π‡™æ‡™≤‡™Æ‡™æ‡™Ç ‡™§‡™π‡´á‡™µ‡™æ‡™∞‡´ã‡™Æ‡™æ‡™Ç ‡™°‡™ø‡™∏‡´ç‡™ï‡™æ‡™â‡™®‡´ç‡™ü ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™õ‡´á. ‡™Ö‡™Ç‡™§‡™ø‡™Æ ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‡™Æ‡™æ‡™ü‡´á ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç ‡™§‡™™‡™æ‡™∏‡´ã.' },
      { q: /service|repair|support|help/i, a: 'We provide doorstep service and free checkups during warranty period.', gu: '‡™Ö‡™Æ‡´á ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™∏‡™Æ‡™Ø‡™ó‡™æ‡™≥‡™æ ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® ‡™°‡´ã‡™∞‡™∏‡´ç‡™ü‡´á‡™™ ‡™∏‡™∞‡´ç‡™µ‡™ø‡™∏ ‡™Ö‡™®‡´á ‡™Æ‡™´‡™§ ‡™ö‡´á‡™ï‡™Ö‡™™‡´ç‡™∏ ‡™™‡´ç‡™∞‡™¶‡™æ‡™® ‡™ï‡™∞‡´Ä‡™è ‡™õ‡´Ä‡™è.' },
      { q: /exchange|old machine|return/i, a: 'You can exchange your old appliance and get up to ‚Çπ5,000 off.', gu: '‡™§‡™Æ‡´á ‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™ú‡´Ç‡™®‡´Å‡™Ç ‡™â‡™™‡™ï‡™∞‡™£ ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™ï‡™∞‡´Ä ‡™∂‡™ï‡´ã ‡™õ‡´ã ‡™Ö‡™®‡´á ‚Çπ5,000 ‡™∏‡´Å‡™ß‡´Ä‡™®‡´Ä ‡™õ‡´Ç‡™ü ‡™Æ‡´á‡™≥‡™µ‡´Ä ‡™∂‡™ï‡´ã ‡™õ‡´ã.' },
      { q: /.*/, a: 'Sorry, I do not have that exact information. You can ask about price, capacity, warranty or cleaning and I will answer.', gu: '‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã, ‡™Æ‡™æ‡™∞‡™æ ‡™™‡™æ‡™∏‡´á ‡™§‡´á ‡™ö‡´ã‡™ï‡´ç‡™ï‡™∏ ‡™Æ‡™æ‡™π‡™ø‡™§‡´Ä ‡™®‡™•‡´Ä. ‡™§‡™Æ‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§, ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ, ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™Ö‡™•‡™µ‡™æ ‡™∏‡™æ‡™´‡™∏‡™´‡™æ‡™à ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã.' }
    ];

    // ------------------ PRODUCT DATA (images array included) ------------------
    const PRODUCT_DATA = {
      id: 'washing-machine-7kg',
      title: 'SuperClean 7 kg Front Load',
      title_gu: '‡™∏‡´ã‡™™‡™∞‡™ï‡´ç‡™≤‡´Ä‡™® 7 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ ‡™´‡´ç‡™∞‡™®‡´ç‡™ü ‡™≤‡´ã‡™°',
      tagline: 'Efficient ‚Ä¢ Quiet ‚Ä¢ Durable',
      img: 'assets/wm1.avif',
      images: [
        'assets/wm1.avif',
        'assets/wm2.avif',
        'assets/wm3.avif',
        'assets/wm4.avif',
        'assets/wm5.avif'
      ],
      logo: 'assets/ktpl-new-logo.png',
      description: 'This 7 kg front-load washing machine provides powerful cleaning with inverter technology, 8 wash programs, and a stainless steel drum for gentle care. Ideal for small to medium families.',
      description_gu: '‡™Ü 7 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ ‡™´‡´ç‡™∞‡™®‡´ç‡™ü-‡™≤‡´ã‡™° ‡™µ‡´ã‡™∂‡™ø‡™Ç‡™ó ‡™Æ‡™∂‡´Ä‡™® ‡™á‡™®‡´ç‡™µ‡™∞‡´ç‡™ü‡™∞ ‡™ü‡´á‡™ï‡´ç‡™®‡´ã‡™≤‡´ã‡™ú‡´Ä ‡™Ö‡™®‡´á 8 ‡™µ‡´ã‡™∂ ‡™™‡´ç‡™∞‡´ã‡™ó‡´ç‡™∞‡™æ‡™Æ‡´ç‡™∏ ‡™∏‡™æ‡™•‡´á ‡™∂‡™ï‡´ç‡™§‡™ø‡™∂‡™æ‡™≥‡´Ä ‡™∏‡™´‡™æ‡™à ‡™Ü‡™™‡´á ‡™õ‡´á. ‡™®‡™æ‡™®‡™æ-‡™Æ‡™ß‡´ç‡™Ø‡™Æ ‡™™‡™∞‡™ø‡™µ‡™æ‡™∞‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™Ü‡™¶‡™∞‡´ç‡™∂.',
      features: ['7 kg capacity', 'Inverter motor', 'Quick wash 30 min', 'Child lock', '1200 RPM spin'],
      features_gu: ['7 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ', '‡™á‡™®‡´ç‡™µ‡™∞‡´ç‡™ü‡™∞ ‡™Æ‡´ã‡™ü‡™∞', '‡™´‡™æ‡™∏‡´ç‡™ü ‡™µ‡´ã‡™∂ 30 ‡™Æ‡™ø‡™®‡™ø‡™ü', '‡™¨‡™æ‡™≥‡™ï‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™≤‡´ã‡™ï', '1200 RPM'],
      specs: { capacity: '7 kg', spin: '1200 RPM', energy: '5 Star', warranty: '2 years product / 10 years motor' },
      specs_gu: { ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ: '7 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ', ‡™∏‡´ç‡™™‡™ø‡™®: '1200 RPM', ‡™è‡™®‡™∞‡´ç‡™ú‡´Ä: '5 ‡™∏‡´ç‡™ü‡™æ‡™∞', ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä: '2 ‡™µ‡™∞‡´ç‡™∑ ‡™™‡´ç‡™∞‡´ã‡™°‡™ï‡´ç‡™ü / 10 ‡™µ‡™∞‡´ç‡™∑ ‡™Æ‡´ã‡™ü‡™∞' }
    };

    // ------------------ Helpers ------------------
    function isGujaratiText(s){ return /[\u0A80-\u0AFF]/.test(String(s)); }
    function appendLog(txt){ const el=document.getElementById('botLog'); if(el) el.textContent = txt; }

    // ------------------ Load product & render thumbs ------------------
    async function loadProduct(){
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      let data = PRODUCT_DATA;
      if(id){
        try{
          const resp = await fetch('products/' + id + '.json');
          if(resp.ok) data = await resp.json();
        }catch(e){ console.warn('Could not load products/'+id+'.json ‚Äî using inline PRODUCT_DATA') }
      }

      // language param
      const langParam = params.get('lang');
      window._LANG = langParam === 'gu' ? 'gu' : 'en';

      // populate UI
      const title = (window._LANG==='gu' && data.title_gu) ? data.title_gu : data.title;
      document.getElementById('productTitle').textContent = title;
      document.getElementById('productTag').textContent = data.tagline || '';
      document.getElementById('productImg').src = data.img || (data.images && data.images[0]) || 'assets/default-product.png';
      document.getElementById('logo').src = data.logo || 'assets/ktpl-new-logo.png';
      document.getElementById('productDesc').textContent = (window._LANG==='gu' && data.description_gu) ? data.description_gu : data.description;

      // features
      const fl = document.getElementById('featuresList'); fl.innerHTML = '';
      const feats = (window._LANG==='gu' && data.features_gu) ? data.features_gu : data.features || [];
      feats.forEach(f=>{ const li=document.createElement('li'); li.textContent=f; fl.appendChild(li); });

      // specs (choose GU keys if present)
      document.getElementById('specCapacity').textContent = (window._LANG==='gu' && data.specs_gu && data.specs_gu["‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ"]) ? data.specs_gu["‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ"] : (data.specs?.capacity || '');
      document.getElementById('specSpin').textContent = (window._LANG==='gu' && data.specs_gu && data.specs_gu["‡™∏‡´ç‡™™‡™ø‡™®"]) ? data.specs_gu["‡™∏‡´ç‡™™‡™ø‡™®"] : (data.specs?.spin || '');
      document.getElementById('specEnergy').textContent = (window._LANG==='gu' && data.specs_gu && data.specs_gu["‡™è‡™®‡™∞‡´ç‡™ú‡´Ä"]) ? data.specs_gu["‡™è‡™®‡™∞‡´ç‡™ú‡´Ä"] : (data.specs?.energy || '');
      document.getElementById('specWarranty').textContent = (window._LANG==='gu' && data.specs_gu && data.specs_gu["‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä"]) ? data.specs_gu["‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä"] : (data.specs?.warranty || '');

      // QR hint
      const currentUrl = location.href.split('#')[0];
      document.getElementById('qrHint').textContent = currentUrl;

      window._PRODUCT = data;

      // thumbs
      const thumbsWrap = document.getElementById('thumbs'); thumbsWrap.innerHTML = '';
      const imgs = data.images && data.images.length ? data.images : [data.img];
      imgs.forEach((src, idx) => {
        const im = document.createElement('img');
        im.src = src;
        if(idx===0) im.classList.add('active');
        im.onclick = () => {
          document.getElementById('productImg').src = src;
          thumbsWrap.querySelectorAll('img').forEach(x=>x.classList.remove('active'));
          im.classList.add('active');
        };
        thumbsWrap.appendChild(im);
      });
    }

    loadProduct();

    // ------------------ TTS ------------------
    function speak(text){
      if(!('speechSynthesis' in window)){ appendLog('Speech synthesis not supported'); return; }
      const u = new SpeechSynthesisUtterance(text);
      const lang = (window._LANG === 'gu' || isGujaratiText(text)) ? 'gu-IN' : 'en-IN';
      u.lang = lang; u.rate = 1; u.pitch = 1;
      const voices = window.speechSynthesis.getVoices();
      if(voices && voices.length){
        const v = voices.find(x=> x.lang && x.lang.toLowerCase().startsWith(lang.toLowerCase()));
        if(v) u.voice = v;
      } else {
        window.speechSynthesis.onvoiceschanged = ()=> {
          const v2 = window.speechSynthesis.getVoices().find(x=> x.lang && x.lang.toLowerCase().startsWith(lang.toLowerCase()));
          if(v2) u.voice = v2;
          window.speechSynthesis.speak(u);
        };
      }
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    // ------------------ localAnswer using canned ------------------
    function localAnswer(q){
      if(!q){ const fb=canned[canned.length-1]; return (window._LANG==='gu') ? fb.gu : fb.a; }
      const text = String(q).trim();
      const preferGu = (window._LANG === 'gu') || isGujaratiText(text);
      for(let i=0;i<canned.length;i++){
        try{ if(canned[i].q.test(text)) return preferGu ? (canned[i].gu || canned[i].a) : (canned[i].a || canned[i].gu); }
        catch(e){ console.warn('Invalid regex', e); }
      }
      const fb=canned[canned.length-1]; return preferGu ? fb.gu : fb.a;
    }

    // ------------------ UI handlers ------------------
    document.getElementById('askBtn').addEventListener('click', ()=>{
      const q = document.getElementById('userText').value.trim(); if(!q) return;
      appendLog('You: ' + q);
      const ans = localAnswer(q);
      appendLog((window._LANG==='gu' ? '‡™∏‡™π‡™æ‡™Ø‡™ï: ' : 'Assistant: ') + ans);
      speak(ans);
    });

    document.getElementById('readDescBtn').addEventListener('click', ()=>{
      const p = window._PRODUCT || PRODUCT_DATA;
      const text = (window._LANG==='gu' && p.description_gu) ? p.description_gu : p.description;
      appendLog('Reading description...');
      speak(text);
    });

    document.getElementById('langSelect').addEventListener('change', (e)=>{
      window._LANG = e.target.value === 'gu' ? 'gu' : 'en';
      const p = window._PRODUCT || PRODUCT_DATA;
      document.getElementById('productTitle').textContent = (window._LANG==='gu' && p.title_gu) ? p.title_gu : p.title;
      document.getElementById('productDesc').textContent = (window._LANG==='gu' && p.description_gu) ? p.description_gu : p.description;
      const fl = document.getElementById('featuresList'); fl.innerHTML = '';
      const feats = (window._LANG==='gu' && p.features_gu) ? p.features_gu : p.features || [];
      feats.forEach(f=>{ const li=document.createElement('li'); li.textContent=f; fl.appendChild(li); });
      document.getElementById('specCapacity').textContent = (window._LANG==='gu' && p.specs_gu && p.specs_gu["‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ"]) ? p.specs_gu["‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ"] : (p.specs?.capacity || '');
      document.getElementById('specSpin').textContent = (window._LANG==='gu' && p.specs_gu && p.specs_gu["‡™∏‡´ç‡™™‡™ø‡™®"]) ? p.specs_gu["‡™∏‡´ç‡™™‡™ø‡™®"] : (p.specs?.spin || '');
      document.getElementById('specEnergy').textContent = (window._LANG==='gu' && p.specs_gu && p.specs_gu["‡™è‡™®‡™∞‡´ç‡™ú‡´Ä"]) ? p.specs_gu["‡™è‡™®‡™∞‡´ç‡™ú‡´Ä"] : (p.specs?.energy || '');
      document.getElementById('specWarranty').textContent = (window._LANG==='gu' && p.specs_gu && p.specs_gu["‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä"]) ? p.specs_gu["‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä"] : (p.specs?.warranty || '');
    });

    // ------------------ Speech recognition ------------------
    let recognizing=false, recognition=null;
    const startBtn = document.getElementById('startBtn');
    try {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(SpeechRecognition){
        recognition = new SpeechRecognition();
        recognition.lang = 'en-IN'; recognition.interimResults = false; recognition.maxAlternatives = 1;
        recognition.onstart = ()=>{ recognizing=true; startBtn.textContent='üéôÔ∏è Listening... (click to stop)'; }
        recognition.onend = ()=>{ recognizing=false; startBtn.textContent='üé§ Speak'; }
        recognition.onerror = (e)=>{ appendLog('Recognition error: '+e.error); }
        recognition.onresult = (ev)=>{
          const text = ev.results[0][0].transcript;
          document.getElementById('userText').value = text;
          appendLog('You (spoken): ' + text);
          if(isGujaratiText(text)) window._LANG = 'gu';
          const a = localAnswer(text);
          appendLog((window._LANG==='gu' ? '‡™∏‡™π‡™æ‡™Ø‡™ï: ' : 'Assistant: ') + a);
          speak(a);
        };
      } else { startBtn.style.display='none'; appendLog('Speech Recognition not supported in this browser'); }
    } catch(e){ console.error(e); startBtn.style.display='none'; }

    startBtn.addEventListener('click', ()=>{
      if(!recognition){
        const q = prompt((window._LANG==='gu') ? '‡™µ‡™æ‡™ï‡´ç‡™Ø ‡™≤‡™ñ‡´ã:' : 'Type your question:');
        if(q){ document.getElementById('userText').value=q; const a=localAnswer(q); appendLog((window._LANG==='gu'?'‡™∏‡™π‡™æ‡™Ø‡™ï: ':'Assistant: ')+a); speak(a); }
        return;
      }
      if(recognizing) recognition.stop(); else { recognition.lang = (window._LANG==='gu') ? 'gu-IN' : 'en-IN'; recognition.start(); }
    });

    // End script
  </script>
</body>
</html>
